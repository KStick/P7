<DOCTYPE html>
<head>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
	<link rel="stylesheet" type="text/css" href="../mockupCSS.css">
    <link rel="stylesheet" type="text/css" href="../globalCSS.css">
    <!--
        ServerURL change to contact another server
    -->
    <input type="hidden" id="serverCWD" value="http://localhost/P7/proofOfConcept"></input>
    <input type="hidden" id="REST" value="http://localhost:5000"></input>
</head>


<html>
<body>
  	<div class = "main-body">
		<div class = "top-banner">
            <p class = "top-banner-text"> general content </p>
            <p class = "login-link">
                <button id="logout" class="log-out-button" onclick="logOut()">Log out!</button>
                Logged in as: <span id="cookie_name">
                </span><p>

        </div>
        <div class = "content-container">
            <div class = "content-left">
                <p>Public sessions</p>
                <iframe src="table_public_questions.html" width="98%" height="93.5%"></iframe>
            </div>
            <div class = "content-middle">
                <p>Bunch of text describing how to navigate around?</p>
            </div>
            <div class = "content-right">
                <div class = "form-holder">
                    <form onsubmit="validateSubmit(subject.value, question.value, access.value); return false;" autocomplete="on">
                        <label>Subject:</label>
                        <select id="subject" required autofocus>
                            <option value=""> -- select subject --</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Software">Software</option>
                            <option value="Biology">Biology</option>
                            <option value="Medicin">Medicin</option>
                        </select><br><br>
                        <label>Access:</label>
                        <select id="access" required autofocus>
                            <option value=""> -- select access --</option>
                            <option value="private">Private</option>
                            <option value="public">Public</option>
                        </select><br><br>
                        <textarea rows="4" id = "question" class = "question-input-field" placeholder='Please describe your problem' required></textarea><br><br>
                        <input type = "submit" id = "submit-button" value = "Send question">
                    </form>
                </div>                
            </div>
        </div>
	</div>

<script>
    serverCWD = document.getElementById("serverCWD").value.toString();
    REST = document.getElementById("REST").value.toString();

    document.getElementById('cookie_name').textContent = getCookie('Username');

        function validateSubmit(subject, question, access){
            $.ajax({
                data:{username : getCookie("Username"), subject : subject, question : question, access : access, submit : 'yes'},
                type:"POST",
                url: REST + '/Questions',
                headers: {
                    'Access-Control-Allow-Origin': '*'
                },
                success: function(response) {
                    AddSessionHistory(getCookie("Username"), response);
                    document.cookie="SessionID = " + response + ";path=/";
                    window.open(serverCWD + "/session.html");
    
                },
                error: function(error){
                    console.log(error);
                }
            })
        }

    function getCookie(name) {
        var value = "; " + document.cookie;
        var parts = value.split("; " + name + "=");
        if (parts.length == 2) return parts.pop().split(";").shift();
    }

    function logOut(){
        document.cookie = "Username=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/";
        window.location.href = serverCWD;
    }

    function AddSessionHistory(username, sessionID) {
        $.ajax({
            data:{username : username, question_id : sessionID},
            type:"POST",
            url: 'http://localhost:5000/AddSessionHistory',
            headers: {
                'Access-Control-Allow-Origin' : '*'
            },
            error: function(error) {
                console.log(error);
            } 
        })
    }
</script>


</body>
</html>