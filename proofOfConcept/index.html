<DOCTYPE html>
<head>
	<link rel="stylesheet" type="text/css" href="mockupCSS.css">
	<link rel="stuffIdontKnow" type="text/php" href="Post.php">
	<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
	<script src="fabric.js"></script>
</head>


<html>
<body>
    <script>
	var session = prompt("Please enter Session name", "Session");
	document.cookie = "SessionID = " + session;
	$.post("Session.php", {id : session});

	var user = prompt("Please enter username", "Username");
	document.cookie = "Username = " + user;
    </script>

    <script>
	function getCookie(name) {
 	    var value = "; " + document.cookie;
	    var parts = value.split("; " + name + "=");
	    if (parts.length == 2) return parts.pop().split(";").shift();
	}
    </script>

	



	<div class = "main-body">
		<div class="visual-box">
            <canvas id = "whiteboard">
                
            </canvas>
		</div>
		<div class = "chat-window">
			<p>This is some text</p>
		</div>
		<div class = "menu-bar">
            <button id = "change-colour" onclick='colourSwap()'>
+                Change colour
            </button>
	    <button id = "clear">
		Clear
	    </button>
	    <select id="drawingModeSelector">
		<option>Pencil</option>
		<option>Circle</option>
		<option>Spray</option>
	    </select>
			<span class="info">30</span><input type="range" value="30" min="0" max="150" id="drawingLineWidth">
		<input type="color" value="#005E7A" id="drawingColor"><br>
		</div>
		<div class = "chat-box">
			<input type = "text" class = "chat-input" id="user-message">
			</input>
			<button class = "post-message chat-page" id="send-message">
				Send
			</button>
		</div>
	</div>


<script>
	function saveWhiteboard() {
		var ID = getCookie("SessionID");
		var tmp = JSON.stringify(canvas.toJSON());
		$.post("Post.php", {sessionID : ID, data : tmp});
	}
</script>

<script>
	function loadWhiteboard() {
		var ID = getCookie("SessionID");
		$(function(){
   			$.get( ID, function( data ) {
					canvas.loadFromJSON(data, function() {
   			 		canvas.renderAll();
				}); 
   			});
		});
	}
</script>

<script>
        var width = 0;
	var height = 0;
	var canvas;
	$(document).ready(function(){

		<!-- whiteboard functions -->
		width = document.getElementById("whiteboard").offsetWidth;
		height = document.getElementById("whiteboard").offsetHeight;
		canvas = new fabric.Canvas("whiteboard" , {isDrawingMode: true});
		canvas.setWidth(width);
		canvas.setHeight(height);
		canvas.freeDrawingBrush.color = drawingColor.value;		
		loadWhiteboard();
		
		setInterval(loadWhiteboard, 1000);
		canvas.on('path:created', function(e){
			console.log("path created");	
			saveWhiteboard();

		});	

		<!-- chat functions-->

		$("#send-message").click(function(){
			var clientmsg = $("#user-message").val();
			var username = getCookie("Username");
			$.post("chatlog.php", {username : username, text : clientmsg})
			$("#user-message").attr("value", "");
			return false;
		});

	})
	var drawingModeEL = document.getElementById("drawingMode"),
		clearEL = document.getElementById("clear"),
		drawingLineWidthEL = document.getElementById("drawingLineWidth"),
		drawingColorEL = document.getElementById("drawingColor");

	clearEL.onclick = function() { canvas.clear()}
	
	drawingModeEL.onclick = function() {
		canvas.isDrawingMode = !canvas.isDrawingMode;
		if(canvas.isDrawingMode){
			drawingModeEL.innerHTML = "Cancel drawing mode";
		}
		else {
			drawingModeEL.innerHTML = "Enter drawing mode";
		}};
	
	document.getElementById('drawingModeSelector').onchange = function() {
		if(this.value === ""){
			<!--here we can make custom brushes-->
		}	
		else {
			canvas.freeDrawingBrush = new fabric[this.value + 'Brush'](canvas);
		}
		
		canvas.freeDrawingBrush.color = drawingColor.value;
		canvas.freeDrawingBrush.width = parseInt(drawingLineWidthEL.value,10) || 1;
	}
	
	drawingLineWidthEL.onchange = function(){
		canvas.freeDrawingBrush.width = parseInt(this.value, 10) || 1;
		this.previousSibling.innerHTML= this.value;
	}

	drawingColor.onchange = function() {
		canvas.freeDrawingBrush.color = this.value;
	}
</script>


</body>
</html>
